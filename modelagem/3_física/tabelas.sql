/* NESTE ARQUIVO, ESTÃO DISPONÍVEIS OS SCRIPTS USADOS PARA CRIAR TODAS AS TABELAS DO BANCO DE DADOS DO PROJETO */


/* TABELA GERENTES: INFORMAÇÕES DOS GERENTES QUE ADMINISTRAM UMA UNIDADE */
CREATE TABLE GERENTES
(   ID_GERENTE NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(100) NOT NULL,
    IDADE NUMBER(2) NOT NULL,
    APELIDO VARCHAR2(100) NOT NULL,
    ATIVO CHAR(1) NOT NULL,
    DT_CONTRATO DATE NOT NULL,
    DT_DESLIGADO DATE,
    CURRICULO_PDF BLOB,

    CONSTRAINT CK_ATIVO_GERENTES CHECK (ATIVO IN ('N','S'))
);

/* TABELA PROFESSORES: INFORMAÇÕES DOS PROFESSORES REGISTRADOS */
CREATE TABLE PROFESSORES
(   ID_PROF NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(100) NOT NULL,
    APELIDO VARCHAR2(100) NOT NULL,
    IDADE NUMBER NOT NULL,
    DT_NASC DATE NOT NULL,
    HORARIO VARCHAR2(200),
    ATIVO CHAR(1) NOT NULL,
    DT_CONTRATO DATE NOT NULL,
    DT_DESLIGADO DATE,
    CURRICULO_PDF BLOB,
    
    CONSTRAINT CK_ATIVO_PROFESSORES CHECK (ATIVO IN ('N','S'))
);

/* TABELA ACADEMIAS: INFORMAÇÕES DAS ACADEMIAS REGISTRADAS NA REDE, POR EXEMPLO */
CREATE TABLE ACADEMIAS
(   ID_ACAD NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    CIDADE VARCHAR2(50) NOT NULL,
    BAIRRO VARCHAR2(50) NOT NULL,
    DT_INAUGURADA DATE NOT NULL,
    IDADE NUMBER NOT NULL,
    ID_GERENTE NUMBER NOT NULL,
    ATIVA CHAR(1) NOT NULL,
    DT_ENCERRADA DATE,
    FOTO BLOB,
    
    CONSTRAINT FK_IDGERENTE_ACADEMIAS FOREIGN KEY (ID_GERENTE) REFERENCES GERENTES (ID_GERENTE),
    CONSTRAINT CK_ATIVA_ACADEMIAS CHECK (ATIVA IN ('N','S'))
);

/* TABEL OBJETIVOS: INFORMAÇÕES DOS OBJETIVOS QUE OS ALUNOS PODEM ESCOLHER */
CREATE TABLE OBJETIVOS
(   ID_OBJETIVO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    OBJETIVO VARCHAR2(100) NOT NULL
);

/* TABELA ALUNO: INFORMAÇÕES DOS ALUNOS REGISTRADOS */
CREATE TABLE ALUNOS
(   ID_ALUNO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NOME VARCHAR2(100) NOT NULL,
    CPF VARCHAR2(11) NOT NULL,
    SEXO CHAR(1) NOT NULL,
    DT_NASC DATE NOT NULL,
    IDADE NUMBER(2) NOT NULL,
    PESO_KG NUMBER(3) NOT NULL,
    ALTURA_CM NUMBER(3) NOT NULL,
    ID_OBJETIVO NUMBER NOT NULL,
    
    CONSTRAINT CK_SEXO_ALUNOS CHECK (SEXO IN ('F','M')),
    CONSTRAINT FK_IDOBJETIVO_ALUNOS FOREIGN KEY (ID_OBJETIVO) REFERENCES OBJETIVOS (ID_OBJETIVO),
    CONSTRAINT UQ_CPF_ALUNOS UNIQUE (CPF)
);

/* TABELA METAS: INFORMAÇÕES DAS METAS REGISTRADAS POR CADA ALUNO */
CREATE TABLE METAS
(   ID_META NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    META VARCHAR2(100) NOT NULL,
    DT_ALCANCADA DATE,
    ID_ALUNO NUMBER NOT NULL,
    
    CONSTRAINT FK_IDALUNO_METAS FOREIGN KEY (ID_ALUNO) REFERENCES ALUNOS (ID_ALUNO)
);

/* TABELA METAS_ALUNOS_COMPLETAS: NÚMERO DE METAS COMPLETAS NO MÊS E NO TOTAL, PARA CADA ALUNO */
CREATE TABLE METAS_ALUNOS_COMPLETAS
(   ID_ALUNO NUMBER NOT NULL,
    METAS_COMPLETA_MES NUMBER NOT NULL,
    METAS_COMPLETA_TOTAL NUMBER NOT NULL,
    
    CONSTRAINT FK_IDALUNO_METASALUNOSCOMPLETAS FOREIGN KEY (ID_ALUNO) REFERENCES ALUNOS (ID_ALUNO)
);

/* TABELA MODALIDADES: INFORMAÇÕES DAS MODALIDADES REGISTRADAS */
CREATE TABLE MODALIDADES
(   ID_MODALIDADE NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    MODALIDADE VARCHAR2(100) NOT NULL,
    BONUS CHAR(1),
    
    CONSTRAINT CK_BONUS_MODALIDADES CHECK (BONUS IN ('N','S'))
);

/* TABELA HORARIOS: INFORMAÇÕES DOS HORARIOS OS QUAIS AS MODALIDADES PODEM ACONTECER */
CREATE TABLE HORARIOS
(   ID_HORARIO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DIA_SEMANA VARCHAR2(3),
    HORA_INICIO NUMBER(2) NOT NULL,
    HORA_FINAL NUMBER(2) NOT NULL,

    CONSTRAINT CK_DIASEMANA_HORARIOS CHECK (DIA_SEMANA IN ('SEG','TER','QUA','QUI','SEX','SAB','DOM'))
);

/* TABELA ACAD_HORA_PROF_MOD: INFORMAÇÕES DE QUAL ACADEMIA E QUAL PROFESSOR OFERECE EM QUAL HORÁRIO QUAL MODALIDADE (EXCLUINDO MUSCULAÇÃO) */
CREATE TABLE ACAD_HORA_PROF_MOD
(   ID_ACAD NUMBER NOT NULL,
    ID_HORARIO NUMBER NOT NULL,
    ID_PROF NUMBER NOT NULL,
    ID_MODALIDADE NUMBER NOT NULL,
    
    CONSTRAINT PK_IDACADIDHORAIDPROFIDMOD_ACADHORAPROFMOD PRIMARY KEY (ID_ACAD,ID_HORARIO,ID_PROF,ID_MODALIDADE),
    CONSTRAINT UQ_IDHORAIDPROFIDMOD_ACADHORAPROF UNIQUE (ID_HORARIO,ID_PROF,ID_MODALIDADE),
    CONSTRAINT FK_IDACAD_ACADHORAPROFMOD FOREIGN KEY (ID_ACAD) REFERENCES ACADEMIAS (ID_ACAD),
    CONSTRAINT FK_IDHORA_ACADHORAPROFMOD FOREIGN KEY (ID_HORARIO) REFERENCES HORARIOS (ID_HORARIO),
    CONSTRAINT FK_IDPROF_ACADHORAPROFMOD FOREIGN KEY (ID_PROF) REFERENCES PROFESSORES (ID_PROF),
    CONSTRAINT FK_IDMOD_ACADHORAPROFMOD FOREIGN KEY (ID_MODALIDADE) REFERENCES MODALIDADES (ID_MODALIDADE),
    CONSTRAINT CK_IDMOD_ACADHORAPROFMOD CHECK (ID_MODALIDADE != 6),
    CONSTRAINT CK_IDHORA_ACADHORAPROFMOD CHECK (ID_HORARIO NOT IN (1,8,13,19,24,30,33))
);

/* TABELA ACAD_HORA_PROF_MUSC: INFORMAÇÕES DE QUAL ACADEMIA E QUAL PROFESSOR OFERECE MUSCULAÇÃO EM QUAIS HORÁRIOS */
CREATE TABLE ACAD_HORA_PROF_MUSC
(   ID_ACAD NUMBER NOT NULL,
    ID_HORARIO NUMBER NOT NULL,
    ID_PROF NUMBER NOT NULL,
    ID_MODALIDADE NUMBER NOT NULL,
    
    CONSTRAINT PK_IDACADIDHORAIDPROFIDMOD_ACADHORAPROFMUSC PRIMARY KEY (ID_ACAD,ID_HORARIO,ID_PROF,ID_MODALIDADE),
    CONSTRAINT UQ_IDHORAIDPROF_ACADHORAPROFMUSC UNIQUE (ID_HORARIO,ID_PROF),
    CONSTRAINT FK_IDACAD_ACADHORAPROFMUSC FOREIGN KEY (ID_ACAD) REFERENCES ACADEMIAS (ID_ACAD),
    CONSTRAINT FK_IDHORA_ACADHORAPROFMUSC FOREIGN KEY (ID_HORARIO) REFERENCES HORARIOS (ID_HORARIO),
    CONSTRAINT FK_IDPROF_ACADHORAPROFMUSC FOREIGN KEY (ID_PROF) REFERENCES PROFESSORES (ID_PROF),
    CONSTRAINT CK_IDMOD_ACADHORAPROFMUSC CHECK (ID_MODALIDADE = 6)
);

/* TABELA TREINOS: INFORMAÇÕES A RESPEITO DOS TREINOS REGISTRADOS PELOS ALUNOS */
CREATE TABLE TREINOS
(   ID_TREINO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DT_INICIO DATE NOT NULL,
    DT_FINAL DATE,
    DURACAO_MIN NUMBER(3),
    KCALS NUMBER(4),
    ID_ALUNO NUMBER NOT NULL,
    ID_MODALIDADE NUMBER NOT NULL,
    ID_ACAD NUMBER NOT NULL,
    
    CONSTRAINT FK_IDALUNO_TREINOS FOREIGN KEY (ID_ALUNO) REFERENCES ALUNOS (ID_ALUNO),
    CONSTRAINT FK_IDMODALIDADE_TREINOS FOREIGN KEY (ID_MODALIDADE) REFERENCES MODALIDADES (ID_MODALIDADE),
    CONSTRAINT FK_IDACAD_TREINOS FOREIGN KEY (ID_ACAD) REFERENCES ACADEMIAS (ID_ACAD)
);

/* TABELA CHECK_INS: REGISTRA OS CHECKINS REALIZADOS PELOS ALUNOS */
CREATE TABLE CHECK_INS
(   ID_CHECKIN NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DT_ENTRADA DATE NOT NULL,
    DT_SAIDA DATE,
    DURACAO_MIN NUMBER(3),
    ID_ALUNO NUMBER NOT NULL,
    ID_ACAD NUMBER NOT NULL,
    
    CONSTRAINT FK_IDALUNO_CHECKINS FOREIGN KEY (ID_ALUNO) REFERENCES ALUNOS (ID_ALUNO),
    CONSTRAINT FK_IDACAD_CHECKINS FOREIGN KEY (ID_ACAD) REFERENCES ACADEMIAS (ID_ACAD)
);

/* TABELA PLANOS: INFORMAÇÕES A RESPEITO DOS PLANOS OFERECIDOS */
CREATE TABLE PLANOS
(   ID_PLANO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    PLANO VARCHAR2(50) NOT NULL,
    DURACAO_MES NUMBER(2) NOT NULL,
    VALOR_R$ NUMBER(3) NOT NULL,
    VALOR_MES_R$ NUMBER(3) NOT NULL,
    OBSERVACOES VARCHAR2(200)
);

/* TABELA MATRICULAS: INFORMAÇÕES DAS MATRICULAS REALIZADAS PELOS ALUNOS */
CREATE TABLE MATRICULAS
(   ID_MATRICULA NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DT_MATRICULA DATE NOT NULL,
    STATUS CHAR(1) NOT NULL,
    ID_ALUNO NUMBER NOT NULL,
    ID_MODALIDADE NUMBER NOT NULL,
    ID_PLANO NUMBER NOT NULL,
    
    CONSTRAINT CK_STATUS_MATRICULAS CHECK (STATUS IN ('N','S')),
    CONSTRAINT FK_IDALUNO_MATRICULAS FOREIGN KEY (ID_ALUNO) REFERENCES ALUNOS (ID_ALUNO),
    CONSTRAINT FK_IDMODALIDADE_MATRICULAS FOREIGN KEY (ID_MODALIDADE) REFERENCES MODALIDADES (ID_MODALIDADE),
    CONSTRAINT FK_IDPLANO_MATRICULAS FOREIGN KEY (ID_PLANO) REFERENCES PLANOS (ID_PLANO),
    CONSTRAINT UQ_IDALUNOIDMOD_MATRICULAS UNIQUE (ID_ALUNO,ID_MODALIDADE),
    CONSTRAINT UQ_IDALUNOIDMODIDPLANO_MATRICULAS UNIQUE (ID_ALUNO,ID_MODALIDADE,ID_PLANO)
);

/* TABELA PAGAMENTOS: REGISTRA OS PAGAMENTOS REALIZADOS PELOS ALUNOS */
CREATE TABLE PAGAMENTOS
(   ID_PAGAMENTO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DT_PAGAMENTO DATE NOT NULL,
    FORMA_PAG VARCHAR(3) NOT NULL,
    ID_MATRICULA NUMBER NOT NULL,
    DT_PROXIMO_PAG DATE,
    VALOR_PROXIMO_PAG NUMBER,
    
    CONSTRAINT CK_FORMAPG_PAGAMENTOS CHECK (FORMA_PAG IN ('CC','CD','PIX')),
    CONSTRAINT FK_IDMATRICULA_PAGAMENTOS FOREIGN KEY (ID_MATRICULA) REFERENCES MATRICULAS (ID_MATRICULA)
);

/* TABELA DESAFIOS_TIPOS: INFORMAÇÕES DOS TIPOS A QUAL UM GRUPO DE DESAFIOS PERTENCE */
CREATE TABLE DESAFIOS_TIPOS
(   ID_TIPO_DESAFIO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    TIPO_DESC VARCHAR2(50) NOT NULL,
    REINICIA CHAR(1) NOT NULL,
    MENSAL CHAR(1) NOT NULL,
    
    CONSTRAINT CK_REINICIA_DESAFIOSTIPOS CHECK (REINICIA IN ('N','S')),
    CONSTRAINT CK_MENSAL_DESAFIOSTIPOS CHECK (MENSAL IN ('N','S'))
);

/* TABELA DESAFIOS: INFORMAÇÕES DOS DESAFIOS QUE OS ALUNOS PODEM COMPLETAR */
CREATE TABLE DESAFIOS
(   ID_DESAFIO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DESAFIO_DESC VARCHAR2(100) NOT NULL,
    ID_TIPO NUMBER NOT NULL,
    QTD_REQUER NUMBER NOT NULL,
    PONTOS NUMBER NOT NULL,
    
    CONSTRAINT FK_IDTIPO_DESAFIOS FOREIGN KEY (ID_TIPO) REFERENCES DESAFIOS_TIPOS (ID_TIPO_DESAFIO)
);

/* TABELA DESAFIOS_ALUNOS: INFORMAÇÕES DO PROGRESSO DOS ALUNOS EM CADA DESAFIO */
CREATE TABLE DESAFIOS_ALUNOS
(   ID_DESAFIO NUMBER NOT NULL,
    ID_ALUNO NUMBER NOT NULL,
    PROGRESSO NUMBER,
    CONCLUIDO CHAR(1) NOT NULL,
    DT_ATUALIZADO DATE,
    
    CONSTRAINT PK_IDDESAFIOIDALUNO_DESAFIOSALUNOS PRIMARY KEY (ID_DESAFIO, ID_ALUNO),
    CONSTRAINT FK_IDDESAFIO_DESAFIOSALUNOS FOREIGN KEY (ID_DESAFIO) REFERENCES DESAFIOS (ID_DESAFIO),
    CONSTRAINT FK_IDALUNO_DESAFIOSALUNOS FOREIGN KEY (ID_ALUNO) REFERENCES ALUNOS (ID_ALUNO)
);

/* TABELA DESAFIOS_MODALIDADES_ALUNOS_PROGRESSOS: INFORMAÇÕES DO PROGRESSO DOS ALUNOS NOS DESAFIOS ENVOLVENDO TREINOS DA MESMA MODALIDADE */
CREATE TABLE DESAFIOS_MODALIDADES_ALUNOS_PROGRESSOS
(   ID_DESAFIO NUMBER NOT NULL,
    ID_MODALIDADE NUMBER NOT NULL,
    ID_ALUNO NUMBER NOT NULL,
    PROGRESSO NUMBER NOT NULL,
    CONCLUIDO CHAR(1) NOT NULL,
    DT_ATUALIZADO DATE NOT NULL,
    
    CONSTRAINT PK_IDDESIDMODIDALU_DESAFIOSMODALIDADESALUNOSPROGRESSOS PRIMARY KEY (ID_DESAFIO,ID_MODALIDADE,ID_ALUNO),
    CONSTRAINT FK_IDDESAFIO_DESAFIOSMODALIDADESALUNOSPROGRESSOS FOREIGN KEY (ID_DESAFIO) REFERENCES DESAFIOS (ID_DESAFIO),
    CONSTRAINT FK_IDMOD_DESAFIOSMODALIDADESALUNOSPROGRESSOS FOREIGN KEY (ID_MODALIDADE) REFERENCES MODALIDADES (ID_MODALIDADE),
    CONSTRAINT FK_IDALUNO_DESAFIOSMODALIDADESALUNOSPROGRESSOS FOREIGN KEY (ID_ALUNO) REFERENCES ALUNOS (ID_ALUNO),
    CONSTRAINT CK_CONCLUIDO_DESAFIOSMODALIDADESALUNOSPROGRESSOS CHECK (CONCLUIDO IN ('N','S'))
);

/* TABELA CHECKINS_CONTAGEM: REGISTRA O TOTAL DE CHECKINS DE CADA ALUNO */
CREATE TABLE CHECKINS_CONTAGEM
(   ID_ALUNO NUMBER PRIMARY KEY,
    CHECKINS_TOTAL NUMBER NOT NULL,
    DT_ULTIMO_CHECKIN DATE,
    
    CONSTRAINT FK_IDALUNO_CHECKINSCONTAGEM FOREIGN KEY (ID_ALUNO) REFERENCES ALUNOS (ID_ALUNO)
);

/* TABELA CHECKINS_CONSECUTIVOS_PONTOS: INFORMAÇÕES DO DESAFIO DE CHECKINS CONSECUTIVOS */
CREATE TABLE CHECKINS_CONSECUTIVOS_PONTOS
(   ID_CHECKIN_META NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DIAS_CONSECUTIVOS NUMBER NOT NULL,
    PONTOS_ADD NUMBER NOT NULL
);

/* TABELA PONTOS: INFORMAÇÕES DA QUANTIDADE DE PONTOS DE CADA ALUNO */
CREATE TABLE PONTOS
(   ID_ALUNO NUMBER PRIMARY KEY,
    PONTOS_TOTAL NUMBER(10) NOT NULL,
    DT_ATUALIZADO DATE NOT NULL,
    
    CONSTRAINT FK_IDALUNO_PONTOS FOREIGN KEY (ID_ALUNO) REFERENCES ALUNOS (ID_ALUNO)
);

/* TABELA RECOMPENSAS:INFORMAÇÕES DAS RECOMPENSAS DISPONÍVEIS */
CREATE TABLE RECOMPENSAS
(   ID_RECOMPENSA NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    RECOMPENSA VARCHAR2(100) NOT NULL,
    ATIVO CHAR(1) NOT NULL,
    CUSTA_PONTOS NUMBER(5) NOT NULL,
    OBSERVACOES VARCHAR(200),

    CONSTRAINT CK_ATIVO_RECOMPENSAS CHECK (ATIVO IN ('N','S'))
);

/* TABELA RESGATES: INFORMAÇÕES DOS RESGATES REALIZADOS PELOS ALUNO */
CREATE TABLE RESGATES
(   ID_RESGATE NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DT_RESGATE DATE NOT NULL,
    ID_ALUNO NUMBER NOT NULL,
    ID_RECOMPENSA NUMBER NOT NULL,
    
    CONSTRAINT FK_IDALUNO_RESGATES FOREIGN KEY (ID_ALUNO) REFERENCES ALUNOS (ID_ALUNO),
    CONSTRAINT FK_IDRECOMPENSA_RESGATES FOREIGN KEY (ID_RECOMPENSA) REFERENCES RECOMPENSAS (ID_RECOMPENSA)
);

/* TABELA SORTEIOS: INFORMAÇÕES DOS SORTEIOS REALIZADOS PELAS ACADEMIAS */
CREATE TABLE SORTEIOS
(   ID_SORTEIO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    DT_REALIZADO DATE NOT NULL,
    ID_RECOMPENSA NUMBER NOT NULL,
    ID_ALUNO NUMBER NOT NULL,
    FINALIZADO NUMBER(1) NOT NULL,
    
    CONSTRAINT FK_IDRECOMPENSA_SORTEIOS FOREIGN KEY (ID_RECOMPENSA) REFERENCES RECOMPENSAS (ID_RECOMPENSA),
    CONSTRAINT FK_IDALUNO_SORTEIOS FOREIGN KEY (ID_ALUNO) REFERENCES ALUNOS (ID_ALUNO),
    CONSTRAINT CK_FINALIZADO_SORTEIOS CHECK (FINALIZADO IN (0,1))
);